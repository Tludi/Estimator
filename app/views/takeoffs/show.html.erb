<% title current_project.name + " - Takeoff" %>


   <h1 class="box_header"><%= current_project.name %></h1>
    
      <p>
      <%= link_to "Wall Types", walltypes_path, :class => "right_link" %> 
        <% if admin? %>
          <%= link_to "Material", materials_path, :class => "right_link" %> 
          <% end -%>
        <span class="left">Division <%= @takeoff.division %> - <%= @takeoff.trade %>

          <%= link_to "- Edit", edit_takeoff_path(@takeoff), :class=>"small" %> 
          <span class="pipe"> | </span>
          <%= link_to "Delete", @takeoff, :confirm => 'Are you sure?', :method => :delete, :class=>"small" %>
          </span><br>
   
      </p>
      <hr>

   <table>
      <tr>
        <th>WallType</th>
        <th>Item</th>
        <th>Level</th>
        <th>Length</th>
        <th>Height</th>
        <th></th>
      </tr>
    <%= form_for @line_item do |f| %>
      <%= f.error_messages %>
      <tr>
        <td><%= f.select(:walltype_id, current_project.walltypes.collect {|wt|
      [wt.name, wt.id]}, {:prompt => "select"}) %>
        <td><%= f.text_field :description, :size => "4" %> </td>
        <td><%= f.text_field :floor, :size => "3" %>
        <td><%= f.text_field :wall_length, :size => "5" %>
        <td><%= f.text_field :wall_height, :size => "5" %>
        <td><%= f.submit "Enter" %>
      </tr>
    <% end %> <!-- end form -->
  </table>

<!-- ******************************************************* -->
  <br>
<div class="layout">
  <table id="box-table-a" class="line_item_list left"> 
    <thead>
      <tr class="left">
        <th scope="col">Wall Type</th>
        <th scope="col">Item</th>
        <th scope="col">Level</th>
        <th scope="col">Length</th>
        <th scope="col">Height</th>
        <th scope="col" class="material">Material</th>
        <th scope="col">Total</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      <% @materials.each do |m| %>
        <% @line_items.each do |line_item| %>
          <% if line_item.material ==  m.name %>
            <tr class="takeoff_line_item left">
              <td><%= Takeoff.locate_walltype(line_item.walltype_id) %> </td>
              <td><%= line_item.description %> </td>
              <td><%= line_item.floor %>
              <td><%= line_item.wall_length%> lft
              <td><%= line_item.wall_height %> lft
              <td class="material"><%= line_item.material %>
              <td><%= Takeoff.calculate(line_item.material, line_item.wall_length, line_item.wall_height) %></td>
    
              <td><%= link_to "Edit", edit_line_item_path(line_item), :class => "small" %> 
              <%= link_to "Delete", line_item, :method => :delete,  :class => "small" %> </td>
            </tr>
          <% end -%>
        <% end -%><!-- end line_item block -->
      <% end -%> <!-- end material block -->
    </tbody>
 </table>

  <div class="right">
    <div class="Right">
      <div class="column">
        <div id="material-box"class="content" >
          <h3>Material Totals</h3>
          <% unless  @line_items.empty? %>
            <% @materials.each do |m| %>

                <ul>
                  <% if m.on_center %>
                    <li><%= m.name %> total: <%= Takeoff.calculate_geometry(m.name, m.geometry, @line_items, m.on_center) %></li>
                    <li>&nbsp;Studs:<%=  Takeoff.calculate_geometry(m.name, m.geometry, @line_items, m.on_center, "studs") %></li>
                  <% else %>
                    <li><%= m.name %> total: <%= Takeoff.calculate_geometry(m.name, m.geometry, @line_items) %></li>
                  <% end -%>
                </ul>

          <% end -%>
          <% end -%>
        </div>
      </div>
    </div>
  </div>
</div>
 